source ~/.deadfiles/.vimperator/settings.vim
source ~/.deadfiles/.vimperator/mappings.vim
source ~/.deadfiles/.vimperator/style.vim

hi Hint -append text-transform: none; padding: 1px; min-width: 18px; min-height: 14px;

command! -nargs=1 Plug source ~/.vimperator/bundle/<args>.js

Plug auto_reload

set hintchars=qdrguopnb

set editor="sh -c 'i3-msg workspace 2 ; vim --remote-tab-wait-silent $0 ; i3-msg workspace back_and_forth'"
set gui=none
set hto=0

map gf <NOP>

nnoremap % :source ~/.vimperatorrc<CR>:echomsg "Resourced!"<CR>

map U gT
map I gt

nmap g      :tabopen http://google.ru/search?q=
nmap x      :tabopen http://slovari.yandex.ru/
nmap q      <ESC>
nmap s      :tabopen<space>
nmap b      :buffer<space>
nmap <C-P>  :set apptab=true<CR>:echomsg "Pinned"<CR>
nmap <C-N>  :set apptab=false<CR>:echomsg "Unpinned"<CR>
nmap v      cv
nmap w      gT
nmap e      gt
nmap .      /
nmap <C-L>  O

imap <C-}>  <C-I>
imap jk     <ESC>

vmap c      <ESC><ESC>c

nnoremap j   5j
nnoremap k   5k
nnoremap ee  :buffer<space>

inoremap <C-]> <Ins><C-a><Ins><C-I>
inoremap <C-a> <Ins><C-a><Ins>

inoremap <C-K>  <NOP>
nnoremap <C-K>  <ESC>

js <<EOJS
var slack_fix_esc = function() {
    var win = window.content.wrappedJSObject;
    if (typeof win.escFixApplied != "undefined") {
        return;
    }

    win.addEventListener('load', function () {
        win.escFixApplied = true;
        win.document.onkeydown = function (e) {
            if (e.keyCode==27) {
                win.$(':focus').blur();
            }
        }
    })
}
EOJS

js <<EOJS
var apply_css = function(css) {
    var win = window.content.wrappedJSObject;

    var style= win.document.createElement('style');

    style.appendChild(win.document.createTextNode(css));

    win.addEventListener('load', function () {
        win.document.body.appendChild(style);
    })
}
EOJS

autocmd!
autocmd LocationChange slack.com js slack_fix_esc()
autocmd LocationChange zabbix.in.ngs.ru setl ht+=| //span[@class='link_menu'] | //div[contains(@class,'app-list-toggle')] | //span[@class='link']
autocmd LocationChange jira.rn setl ht+=| //ul[@id='issuedetails']//*[contains(@class,'value')] | //div[contains(@class,'ghx-detail-close')]
autocmd LocationChange keybr.com js apply_css(".Supporter, .social-shares, span.mark, footer { display: none }\n#Practice-keyboardWrap { position: absolute !important; left: -5000px; }\n.cursor { background: black !important; color: white; border-bottom: 0 !important; }")
autocmd LocationChange /tmp/mutt* set enc=UTF-8

set cpt=slfh

set hin=label

nmap <C-C> :silent execute "!google-chrome-stable \"" + content.location.href + "\" &"<CR>

qmark v https://github.com/kovetskiy/?tab=repositories
qmark g https://github.com/
qmark h https://news.ycombinator.com/
qmark j http://jira.rn/
qmark c http://confluence.rn/

set! browser.tabs.closeWindowWithLastTab=false

echomsg

" vim: set ft=vimperator:
