#!/bin/bash

[ -n "$_LOCK" ] || _LOCK=x exec flock -n $0 $0

set -x

NAME=kuake_${1:-terminal}
shift

main() {
    if [[ "$1" == "1" ]]; then
        while [[ -z "$terminal_id" ]]; do
            local terminal_id=$(xdotool search --classname $NAME)
        done
        i3-msg -q '[instance="'$NAME'"] move scratchpad'
    else
        local terminal_id=$(xdotool search --classname $NAME)
    fi

    shift

    if [[ -z "$terminal_id" ]]; then
        if [[ "${@}" ]]; then
            urxvt -name $NAME -e "${@}" &
        else
            urxvt -name $NAME &
        fi
        main 1 "${@}"
    else
        read screen_num screen_x screen_y screen_width screen_height <<<$(xscreeninfo)
        eval `xdotool getwindowgeometry --shell $terminal_id`
        i3-msg -q '[instance="'$NAME'"] scratchpad show'
        xdotool windowmove --sync $terminal_id  $screen_x $screen_y
        xdotool windowsize --sync $terminal_id $screen_width $(($screen_height*75/100))
    fi
}

main 0 "${@}"
