#!/bin/bash

session="$(basename $0)"

launch_cmd=(urxvt -e tmux)
if [ "$TERM" != "dumb" ]; then
    launch_cmd=(tmux)
fi

if tmux has-session -t $session; then
    exec ${launch_cmd[*]} attach -t $session
else
    rcfile=~/.mcabber/${session/-/rc-}
    fifofile=~/.mcabber/$session.fifo

    rm -f $fifofile

    mkdir -p ~/.mcabber/${session/mcabber-/history-}

    export TERM=screen-256color-so
    exec ${launch_cmd[*]} new -s $session \
        /usr/bin/mcabber \
        -f $rcfile \
        "${@}"
fi
