#!/bin/bash

set -x

session="$(basename $0)"

export EDITOR=${EDITOR:-vim}
export TMUX=

launch_cmd=(urxvt -e tmux)
if [ "$TERM" != "dumb" -a "$TERM" != "linux" ]; then
    launch_cmd=(tmux)
fi

if tmux has-session -t $session; then
    exec ${launch_cmd[*]} attach -t $session
else
    rcfile=~/.mcabber/${session/-/rc-}
    fifofile=~/.mcabber/$session.fifo

    rm -f $fifofile

    mkdir -p ~/.mcabber/${session/mcabber-/history-}

    exec ${launch_cmd[*]} new -s $session \
        /usr/bin/mcabber \
        -f $rcfile \
        "${@}"
fi
