#!/bin/bash

if [[ "$1" == "-w" ]]; then
    shift
    select_window=1
fi

if [[ $# -lt 1 || "$1" == "-h" ]]; then
    echo usage: "$0 [-w] <video.avi>"
    exit 1
fi

if [[ "$select_window" ]]; then
    window_id=$(xwininfo | awk '/Window id/{print $4}')
    select_arg="-#$window_id"
    echo "Press ENTER to move focus on target window and start recording."
    read
    xdotool windowfocus $window_id
else
    select_arg="-s"
fi

exec ffcast $select_arg % ffmpeg -f x11grab -show_region 1 -framerate 25 -video_size %s -i %D+%c -codec:v libx264 -b:v 20000k -vf crop="iw-mod(iw\\,2):ih-mod(ih\\,2)" -y "${@}"
