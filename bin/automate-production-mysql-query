#!/bin/zsh

set -euo pipefail

if [ $# -eq 0 ]; then
    echo "Usage: automate-production-mysql-query <query>"
    exit 1
fi

query=${${(qq)${(j: :)@}}}
echo $query

for slave in {slave-{1..3},master}; do
    pssh -i \
        -H172.16.176.18{1..4} \
        -lroot \
        "mysql -E --socket=/var/run/mysqld/55.$slave.sock \
            -e $query"
done

